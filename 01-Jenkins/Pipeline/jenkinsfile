node
{
  stage('Git-Checkout') {
   git 'https://github.com/Hyndavi09/TestServer.git'
  }
  def project_path="01-Jenkins/Pipeline"
 
 dir(project_path) {
  stage('create artifact folder to store artifact'){
    sh label: '',script: "rm -rf petclinicwarfile"
    sh label: '', script: "mkdir petclinicwarfile"
    }
    stage('Jfrog Artifactory download'){
    def server= Artifactory.server 'artifact'
    def downloadSpec = """{
    "files": [
    {
      "pattern": "petclinic/*.war",
      "target": "/root/.jenkins/workspace/TestServer/01-Jenkins/Pipeline/petclinicwarfile/"  
    }
    ]
    }"""
    server.download(downloadSpec)
   }
}
def project_path="02-Docker"
dir(project_path) {	
    stage('Docker-Stage-Deployment') {
   sh label: 'DOCKER DEPLOYMENT', script: 'docker-compose up -d --build'
  }
  }
  stage('Production - Provisioning Approval') {
  	input "Start provisioning the production server?"
  }
  stage('Downstream Build -- terraform'){
	 build 'Infrastructure'
	}
  }

